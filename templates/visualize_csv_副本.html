<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三维CSV可视化</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-2.6.3.min.js"></script> <!-- 引入 Plotly.js 库 -->
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .csv-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .csv-table th, .csv-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .csv-table th {
            background-color: #273c75;
            color: white;
        }
        #graph-container {
            margin-top: 20px;
            width: 100%;
            height: 600px;
        }
        .toggle-button {
            margin-top: 10px;
            background-color: #273c75;
            color: #ffffff;
            border-radius: 6px;
            cursor: pointer;
            padding: 10px 15px;
            font-size: 14px;
            border: none;
            transition: background-color 0.3s ease;
            text-align: center;
        }
        .toggle-button:hover {
            background-color: #1e2b52;
        }
    </style>
</head>
<body>
    <h1>三维CSV可视化</h1>

    <!-- 表格展示 -->
    <h2>表格展示</h2>
    <button class="toggle-button" onclick="toggleTable()">收起/展开表格</button>
    <table class="csv-table" id="csvTable">
        <thead>
            <tr>
                {% for col in csv_data[0].keys() %}
                <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in csv_data %}
            <tr>
                {% for value in row.values() %}
                <td>{{ value }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- 三维有向图展示 -->
    <h2>三维有向图展示</h2>
    <div id="graph-container"></div>

    <script>
        // 切换表格显示和隐藏
        function toggleTable() {
            var table = document.getElementById("csvTable");
            if (table.style.display === "none") {
                table.style.display = "table";
            } else {
                table.style.display = "none";
            }
        }

        // 获取传递的节点和边数据
        const nodes = {{ nodes | tojson }};
        const edges = {{ edges | tojson }};

        // 为每个节点生成随机的三维坐标
        const nodePositions = {};
        nodes.forEach((node, index) => {
            nodePositions[node] = {
                x: Math.cos(index * 2 * Math.PI / nodes.length),
                y: Math.sin(index * 2 * Math.PI / nodes.length),
                z: Math.sin(index * 2 * Math.PI / nodes.length)
            };
        });

        // 边的绘制数据
        const edgeTraces = edges.map(edge => {
            const start = nodePositions[edge.source];
            const end = nodePositions[edge.target];

            return {
                type: 'scatter3d',
                mode: 'lines',
                x: [start.x, end.x, null],
                y: [start.y, end.y, null],
                z: [start.z, end.z, null],
                line: { width: 2, color: '#888' },
                showlegend: false
            };
        });

        // 节点的绘制数据
        const nodeTrace = {
            type: 'scatter3d',
            mode: 'markers+text',
            x: nodes.map(node => nodePositions[node].x),
            y: nodes.map(node => nodePositions[node].y),
            z: nodes.map(node => nodePositions[node].z),
            marker: { size: 5, color: '#273c75' },
            text: nodes,
            textposition: 'bottom center'
        };

        // 三角形箭头的绘制数据
        // 三角形箭头的绘制数据
        const arrowTraces = edges.map(edge => {
            const end = nodePositions[edge.target];
            const arrowX = end.x * 0.9;
            const arrowY = end.y * 0.9;
            const arrowZ = end.z * 0.9;

            return {
                type: 'scatter3d',
                mode: 'markers',
                x: [arrowX],
                y: [arrowY],
                z: [arrowZ],
                marker: {
                    size: 6,
                    color: '#888',
                    symbol: 'triangle-up', // 使用三角形作为箭头
                    opacity: 1  // 确保箭头显示为实心三角形
                },
                showlegend: false,
                hoverinfo: 'skip'  // 跳过 hover 信息以避免显示灰色球的坐标
            };
        });


        // 合并所有 trace 并绘制
        const data = [...edgeTraces, nodeTrace, ...arrowTraces];
        const layout = {
            title: '三维有向图展示',
            scene: {
                xaxis: { showgrid: false, zeroline: false, visible: false },
                yaxis: { showgrid: false, zeroline: false, visible: false },
                zaxis: { showgrid: false, zeroline: false, visible: false }
            },
            showlegend: false
        };

        Plotly.newPlot('graph-container', data, layout);
    </script>
</body>
</html>
